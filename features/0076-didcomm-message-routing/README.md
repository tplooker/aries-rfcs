# 0076 DID Communication Mediator Message Routing
- Author: Tobias Looker tobias.looker@mattr.global
- Start Date: 2018-11-22 (back date from original indy hipe)

## Status
- Status: [PROPOSED](/README.md#rfc-lifecycle)
- Status Date: 2018-06-14
- Status Note: Supersededs [HIPE](https://github.com/hyperledger/indy-hipe/blob/42fd315eed4a502f34a956abafd80a73700dbcb3/text/agent-message-routing/README.md)

## Summary

Defines how message routing is achieved in DID communication when mediators are involved.

## Motivation

Mediator based message routing as a feature of DID communication is key to delivering on many of the goals set forth for the protocol..//TODO

## Tutorial

### Background

As described in [RFC](), in the transmission of a DID communication message, the message can pass through multiple intermediaries, this is to provide flexibility in how DID communication messages are sent and also has several distinct privacy advantages. The two main types of intermediaries (mediators/relays) are distinguished mainly by whether the sender know about their presence in the message delivery path. With a mediator, the sender knows of its presence and hence must account for them in the delivery of a message. Where as with a relay, the sender is un-aware and hence does not need to account for them.

For the purposes of this RFC as suggested in the title, it will focus on how mediator based message routing is acheived in DID communication.

Routing in a general sense in reference to computer networking is a term most common at layer 1 of the OSI model. It is the mechanism by which the routing of information is achieved......

Within the concept of routing, there are several approaches.....

It is important to note DID communications is a protocol that leverages application level protocols in layer 7 of the OSI model. The layer of routing DID communications defines is a software defined layer of routing, rather than a new networking layer concern....  

The approach to message routing taken by DID communications is not dissimilar to how [onion routing](https://en.wikipedia.org/wiki/Onion_routing) occurs on the TOR network. Mediator agents can be likened to [TOR relay's](https://www.eff.org/torchallenge/what-is-tor.html).  

However with TOR, the main objective is to ephemeral create new connections for users to the internet through a randomly constructed collection of TOR relays in order to protect the users anonimity online.

Whereas DID communications is primarily concerned with establishing longer term message delivery paths for recipients.

The primary differences between TOR is the talk about in reference to the OSI layers????????

### Example Scenario

Below depicts a simple example between Alice and Bobs agents, whereby Alice is sending a message to Bob via the mediator agents-r-us.

//TODO insert diagram

It is important to realize that with this type of routing, Bob is incharge of defining to Alice how a message should be sent in order for the message to arrive at Bob.

To Alice, her view of the above scenario looks like the following.

//TODO insert diagram

Alice knows about agents-r-us (i.e she possesses an endpoint) and base on how she prepared the message, she knows agents-r-us will further on deliver the message, however the ultimate location is un-known to her.

Using the DID document conventions defined in [RFC](TODO) an example of how the DID document generated by Bob and given to Alice might look.

//TODO insert the DID doc example

Given the definition

### Routing Message Family

This RFC introduces the definition of the following message family

`did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/routing/0.1`

This message family includes the following messages

**Forward Message Definition**

```
{
  "@type" : "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/routing/1.0/forward",
  "to"   : "<recipient-identifier>",
  "msg"  : "<message-to-forward>"
}
```

**Forward To Multiple Message Definition**

```
{
  "@type" : "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/routing/1.0/forward",
  "to"   : ["<recipient-identifier>", "<recipient-identifier-2>"],
  "msg"  : "<message-to-forward>"
}
```

Please note there are several other messages defined in this message family that are not covered in this RFC and are instead covered in [RFC](TODO)

//TODO forward to endpoint???

## Reference

Provide guidance for implementers, procedures to inform testing,
interface definitions, formal function prototypes, error codes,
diagrams, and other technical details that might be looked up.
Strive to guarantee that:

- Interactions with other features are clear.
- Implementation trajectory is well defined.
- Corner cases are dissected by example.

## Drawbacks

Why should we *not* do this?

## Rationale and alternatives

- Why is this design the best in the space of possible designs?
- What other designs have been considered and what is the rationale for not
choosing them?
- What is the impact of not doing this?

## Prior art

Discuss prior art, both the good and the bad, in relation to this proposal.
A few examples of what this can include are:

- Does this feature exist in other SSI ecosystems and what experience have
their community had?
- For other teams: What lessons can we learn from other attempts?
- Papers: Are there any published papers or great posts that discuss this?
If you have some relevant papers to refer to, this can serve as a more detailed
theoretical background.

This section is intended to encourage you as an author to think about the
lessons from other implementers, provide readers of your proposal with a
fuller picture. If there is no prior art, that is fine - your ideas are
interesting to us whether they are brand new or if they are an adaptation
from other communities.

Note that while precedent set by other communities is some motivation, it
does not on its own motivate an enhancement proposal here. Please also take
into consideration that Aries sometimes intentionally diverges from common
identity features.

## Unresolved questions

- What parts of the design do you expect to resolve through the
enhancement proposal process before this gets merged?
- What parts of the design do you expect to resolve through the
implementation of this feature before stabilization?
- What related issues do you consider out of scope for this 
proposal that could be addressed in the future independently of the
solution that comes out of this doc?
